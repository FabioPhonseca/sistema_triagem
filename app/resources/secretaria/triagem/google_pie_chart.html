<!--[main]-->
<!--
 @Author: Fabio Fonseca <ff@fabiofonseca.com.br>
 Based on Adianti Framework (LGPL) - Pablo Dall’Oglio
-->
<div id="chart_pie_div_{$uniqid}" class="chart card panel" style="width: {$width}; height: {$height};"> <i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>Loading </div>
<script>
$(function() {
    if (typeof Adianti.chartsQueue == 'undefined')
    {
        Adianti.chartsQueue = new Array;
    }
    function render_charts()
    {
        Adianti.chartsLoaded = true;
        while (Adianti.chartsQueue.length > 0)
        {
            next = Adianti.chartsQueue.shift();
            next();
        }
    }
    
    var render_pie_chart = function() {
        var raw  = {$data|raw}; 
        var data = google.visualization.arrayToDataTable( {$data|raw} );
        var options = {
          title : '{$title}',
          legend: { position: 'right' }
        };
        
        var hole = parseFloat('{$pie_hole}');
        if (!isNaN(hole) && hole > 0) { options.pieHole = hole; }

        var labelColors   = {$label_colors|raw} || {}; // {"Pericica":"#27AE60",...}
        var computedColors = [];
        for (var i = 1; i < raw.length; i++) { // pula o cabeçalho
        var label = raw[i][0];               // "Pericica", "Balcao", "Outros"
        if (labelColors[label]) computedColors.push(labelColors[label]);
        }
        if (computedColors.length) options.colors = computedColors;

        var chart = new google.visualization.PieChart(document.getElementById('chart_pie_div_{$uniqid}'));
        chart.draw(data, options);
    };
  
    if (Adianti.chartsQueue.length == 0) {
        Adianti.chartsQueue.push( render_pie_chart );
        
        if (typeof google === 'undefined' || typeof google.visualization === 'undefined') {
            jQuery.ajax({
                    type: "GET",
                    url: "https://www.gstatic.com/charts/loader.js",
                    success: function() {
                        google.charts.load('current', {'packages':['bar', 'line', 'corechart']});
                        google.charts.setOnLoadCallback(render_charts);
                    },
                    dataType: "script",
                    cache: true
            });
        }
        else {
            render_charts();
        }
    }
    else
    {
        Adianti.chartsQueue.push( render_pie_chart );
    }
});
</script>
<!--[/main]-->